@model ConfirmProgressVm
@{
    ViewData["Title"] = "Review";
}

<div class="cp-card">
    <h1 class="cp-title">Review Progress</h1>

    @if (ViewData.ModelState.ErrorCount > 0)
    {
        <div class="cp-error">
            <ul class="mb-0 ps-3">
                @foreach (var entry in ViewData.ModelState.Values)
                {
                    @foreach (var err in entry.Errors)
                    {
                        <li>@err.ErrorMessage</li>
                    }
                }
            </ul>
        </div>
    }

    <div class="cp-confirm-photo">
        <img src="@Model.ImagePath" alt="Carpet photo" />
    </div>

    <div class="cp-confirm-barcode">
        <span class="cp-kv-label">Barcode</span>
        <span class="cp-kv-value">@Model.Barcode</span>
    </div>

    <form id="confirmForm" asp-controller="Progress" asp-action="Confirm" method="post">
        <input type="hidden" name="Barcode" value="@Model.Barcode" />
        <input type="hidden" name="ImagePath" value="@Model.ImagePath" />

        <div class="cp-field">
            <label for="progressDate" class="cp-label">Work Date</label>
            <input type="date" name="ProgressDate" id="progressDate" class="cp-input" value="@Model.ProgressDate.ToString("yyyy-MM-dd")" />
        </div>

        <div class="cp-field">
            <label for="normalPct" class="cp-label">Normal % (black marker)</label>
            <input type="number" name="NormalPercent" id="normalPct" class="cp-input" step="0.01" min="0" max="100" value="@Model.NormalPercent" />
        </div>

        <div class="cp-field">
            <label for="otPct" class="cp-label">OT % (red marker)</label>
            <input type="number" name="OtPercent" id="otPct" class="cp-input" step="0.01" min="0" max="100" value="@Model.OtPercent" />
        </div>

        <div class="cp-field">
            <label for="totalPct" class="cp-label">Total %</label>
            <input type="number" name="TotalPercent" id="totalPct" class="cp-input cp-input-locked" step="0.01" value="@Model.TotalPercent" readonly />
        </div>
    </form>

    <a asp-controller="Home" asp-action="Index" class="cp-ghost-link">Back to Scan</a>
</div>

<div class="cp-action-bar">
    <button type="submit" form="confirmForm" class="cp-submit cp-submit-success">Confirm &amp; Save</button>
</div>

@section Scripts {
    <script>
        var normalEl = document.getElementById('normalPct');
        var otEl = document.getElementById('otPct');
        var totalEl = document.getElementById('totalPct');
        function recalc() {
            var n = parseFloat(normalEl.value) || 0;
            var o = parseFloat(otEl.value) || 0;
            totalEl.value = (n + o).toFixed(2);
        }
        normalEl.addEventListener('input', recalc);
        otEl.addEventListener('input', recalc);
    </script>
}
